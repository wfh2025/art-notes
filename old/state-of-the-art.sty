\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{state-of-the-art}

\usepackage{
  algorithm,
  algorithmic,
  amsthm,
  amsmath,
  amssymb,
  animate,
  array,
  blindtext,
  bm,
  booktabs,
  boxedminipage,
  caption,
  courier,
  datetime2,
  diagbox,
  fancybox,
  float,
  fontspec,
  inconsolata,
  lettrine,
  longtable,
  lineno,
  listings,
  makecell,
  mathdots,
  mathrsfs,
  mathtools,
  multicol,
  multirow,
  % paralist,
  subcaption, % 注意: subcaption与subfig可能会冲突，不建议用subfig
  subfiles,
  tikz,
  todonotes,
  wasysym,
  wrapfig,
  xparse,
  yhmath,
}

\usepackage[normalem]{ulem} % 添加下划线
\usepackage[export]{adjustbox} % 图片边框

% \usepackage[english]{babel}
% \usepackage[utf8]{inputenc}

% 图片加载包
\usepackage{graphicx}

% LaTeX符号宏包
\usepackage{hologo}
\newcommand{\xelatex}{\Hologo{XeLaTeX}}
\newcommand{\bibtex}{\Hologo{BibTeX}}
\newcommand{\biber}{\Hologo{biber}}
\newcommand{\tikzz}{Ti\textit{k}Z}
\newcommand{\bz}{B\'ezier}

\usepackage[table]{xcolor}
\newcommand{\scol}[1]{\colorbox{#1}{\rule{0em}{1ex}}\,#1}

\usepackage[listings, skins, breakable, xparse, raster, hooks,
theorems, fitting]{tcolorbox}

\usepackage[inline]{enumitem}
% \setlist[enumerate]{font=\bfseries,itemsep=0pt}
% \setlist[itemize]{font=\bfseries,leftmargin=\parindent}
% \setlist[description]{font=\bfseries\uline,labelindent=\parindent,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt}

% 页面布局
\usepackage[
  a4paper,
  headheight = 14.5pt,
]{geometry}

% 页眉页脚
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\nouppercase{\rightmark}}
\fancyhead[LO,RE]{\nouppercase{\leftmark}}

% \fancyhead[LE,RO]{\rightmark}
% \fancyhead[LO,RE]{\leftmark}

\fancyfoot{}
\fancyfoot[C]{\thepage}
% \fancyfoot[LE,RO]{\thepage}
% \fancyfoot[LO,RE]{更新至\today}

% biblatex参考文献及相关配置
\usepackage[
  style = gb7714-2015,
  backend = biber,
  sorting = ynt
]{biblatex}
\addbibresource{ref/ref.bib}

% 超链接
\usepackage[
  colorlinks = true,
  linkcolor = black,
  citecolor = black,
  urlcolor = magenta,
  anchorcolor = black,
]{hyperref}

% 常量
\renewcommand{\listfigurename}{示意图}
\renewcommand{\lstlistingname}{示例}
\renewcommand{\lstlistlistingname}{示意代码}

% 定义颜色，支持多种颜色模型
% package: xcolor
\definecolor{lightgrey}{rgb}{0.9,0.9,0.9}
\definecolor{frenchplum}{RGB}{190,20,83}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\lstdefinestyle{CodeLstStylePlainText} {
  backgroundcolor = \color{white},
  basicstyle = \small\ttfamily,               % 基础输出样式
  breakatwhitespace = false,
  breaklines = true,
  classoffset = 0,
  captionpos = b,
  columns = fullflexible,
  keywordstyle = \color{blue},                % 关键字风格
  lineskip = -1pt,                             % 行间距，允许负数
  commentstyle = \color{gray},                % 注释风格
  emph = {
  },
  emphstyle={\color{frenchplum}},
  frame = tb,                                 % 边框显示
  morekeywords = {
  },
  numbers = left,                             % 行号位置
  numberblanklines = true,                    % 空行是否显示行号
  numbersep = 5pt,
  numberstyle = \tiny\color{gray},
  rulecolor = \color{black},                  % 边框颜色
  showspaces = false,                         % 是否显示空格
  showstringspaces = false,                   % 字符串常量是否显示空格
  showtabs = false,                           % 是否显示tab
  stepnumber = 1,
  tabsize = 2,                                % tab长度
}

\lstdefinestyle{CodeLstStyleLaTeX} {
  language = [LaTeX]TeX,
  backgroundcolor = \color{white},
  basicstyle = \small\ttfamily,               % 基础输出样式
  breakatwhitespace = false,
  breaklines = true,
  classoffset = 0,
  captionpos = b,
  columns = fullflexible,
  keywordstyle = \color{blue},                % 关键字风格
  lineskip = -1pt,                             % 行间距，允许负数
  commentstyle = \color{gray},                % 注释风格
  emph = {
    fontenc,
    fontspec,
    xeCJK,
    FiraMono,
    xunicode,
    newtxmath,
    figure,
    fig,
    image,
    img,
    table,
    itemize,
    enumerate,
    newtxtext,
    newtxtt,
    ctex,
    microtype,
    description,
    times,
    newtx,
    booktabs,
    tabular,
    PDFLaTeX,
    XeLaTeX,
    type1cm,
    BibTeX,
    device,
    color,
    mode,
    chinesefont,
    cite,
    bibstyle,
    math,
    lang,
    amsthm,
  },
  emphstyle={\color{frenchplum}},
  frame = tb,                                 % 边框显示
  morekeywords = {
    DeclareSymbolFont,
    setCJKfamilyfont,
    SetSymbolFont,
    toprule,
    midrule,
    bottomrule,
    institute,
    version,
    includegraphics,
    setmainfont,
    setsansfont,
    setmonofont ,
    setCJKmainfont,
    setCJKsansfont,
    setCJKmonofont,
    RequirePackage,
    figref,
    pagecolor,
    definecolor,
    tabref,
    email,
    maketitle,
    keywords,
  },
  numbers = left,                             % 行号位置
  numberblanklines = true,                    % 空行是否显示行号
  numbersep = 5pt,
  numberstyle = \tiny\color{gray},
  rulecolor = \color{black},                  % 边框颜色
  showspaces = false,                         % 是否显示空格
  showstringspaces = true,                    % 字符串常量是否显示空格
  showtabs = false,                           % 是否显示tab
  stepnumber = 1,
  tabsize = 2,                                % tab长度
}

\lstdefinestyle{CodeLstStyleCpp} {
  language = C++,
  backgroundcolor = \color{white},
  basicstyle = \small\ttfamily,               % 基础输出样式
  breakatwhitespace = false,
  breaklines = true,
  classoffset = 0,
  captionpos = b,
  columns = fullflexible,
  keywordstyle = \color{blue},                % 关键字风格
  lineskip = -1pt,                            % 行间距，允许负数
  commentstyle = \color{gray},                % 注释风格
  emph = {
  },
  emphstyle={\color{frenchplum}},
  frame = tb,                                 % 边框显示
  morekeywords = {
  },
  numbers = left,                             % 行号位置
  numberblanklines = true,                    % 空行是否显示行号
  numbersep = 5pt,
  numberstyle = \tiny\color{gray},
  rulecolor = \color{black},                  % 边框颜色
  showspaces = false,                         % 是否显示空格
  showstringspaces = true,                    % 字符串常量是否显示空格
  showtabs = false,                           % 是否显示tab
  stepnumber = 1,
  tabsize = 2,                                % tab长度
}

\lstdefinestyle{CodeLstStylePython} {
  language = Python,
  backgroundcolor = \color{white},
  basicstyle = \small\ttfamily,               % 基础输出样式
  breakatwhitespace = false,
  breaklines = true,
  classoffset = 0,
  captionpos = b,
  columns = fullflexible,
  keywordstyle = \color{blue},                % 关键字风格
  lineskip = -1pt,                            % 行间距，允许负数
  commentstyle = \color{gray},                % 注释风格
  emph = {
  },
  emphstyle={\color{frenchplum}},
  frame = tb,                                 % 边框显示
  morekeywords = {
  },
  numbers = left,                             % 行号位置
  numberblanklines = true,                    % 空行是否显示行号
  numbersep = 5pt,
  numberstyle = \tiny\color{gray},
  rulecolor = \color{black},                  % 边框颜色
  showspaces = false,                         % 是否显示空格
  showstringspaces = true,                    % 字符串常量是否显示空格
  showtabs = false,                           % 是否显示tab
  stepnumber = 1,
  tabsize = 2,                                % tab长度
}

\lstdefinestyle{CodeLstStyleSwift} {
  language = Swift,
  backgroundcolor = \color{white},
  basicstyle = \small\ttfamily,               % 基础输出样式
  breakatwhitespace = false,
  breaklines = true,
  classoffset = 0,
  captionpos = b,
  columns = fullflexible,
  keywordstyle = \color{blue},                % 关键字风格
  lineskip = -1pt,                            % 行间距，允许负数
  commentstyle = \color{gray},                % 注释风格
  emph = {
  },
  emphstyle={\color{frenchplum}},
  frame = tb,                                 % 边框显示
  morekeywords = {
  },
  numbers = left,                             % 行号位置
  numberblanklines = true,                    % 空行是否显示行号
  numbersep = 5pt,
  numberstyle = \tiny\color{gray},
  rulecolor = \color{black},                  % 边框颜色
  showspaces = false,                         % 是否显示空格
  showstringspaces = false,                    % 字符串常量是否显示空格
  showtabs = false,                           % 是否显示tab
  stepnumber = 1,
  tabsize = 2,                                % tab长度
}

\newtcolorbox{ArtCaution} {
  colback = red!5!white,
  colframe = red!75!black,
  title = {注意},
}

\NewTCBListing{CodeTcbWithEffectH}{!O{listing side text} }{ %
  colback = white,
  colframe = black,
  % left = 6mm,
  listing options = {
    style = CodeLstStyleLaTeX,
    frame = none,
  },#1,
}

\newtcblisting{CodeTcbWithEffectV} {
  colback = white,
  colframe = white,
  % left = 6mm,
  % title = {#1},
  listing options = {
    style = CodeLstStyleLaTeX,
  },
}

\newtcblisting{CodeTcbLaTeX} {
  colback = white,
  colframe = white,
  % left = 6mm,
  % title = {#1},
  listing options = {
    style = CodeLstStyleLaTeX,
  },
  listing only,
}

% 概念
% 注意: 代码中的%避免多的空格
\newcommand{\ArtConcept}[1]{
  {%
    \bfseries{#1}%
  }%
}

\newtcbox{\ArtLateXInline}[1][blue]{
  on line,
  before upper=\ttfamily\char`\\,
  arc = 0pt,
  outer arc = 0pt,
  colback = #1!10!white,
  colframe = #1!50!black,
  boxsep = 0pt,
  left = 1pt,
  right = 1pt,
  top = 1pt,
  bottom = 1pt,
  boxrule = 0pt,
  bottomrule = 1pt,
  toprule = 1pt,
}

\newenvironment{ArtPara}{
\begin{description}[font=\bfseries\ttfamily,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]}
    {
\end{description}}

\newcommand{\ArtTabRef}[1] {%
  表\ref{#1}%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Quote 环境
\newenvironment{QuoteEnv}[2][]
{\newcommand\Qauthor{#1}\newcommand\Qref{#2}}
{\medskip
  \begin{flushright}\small ——~\Qauthor\\
    \emph{\Qref}
\end{flushright}}

\newcommand\figcaption{\def\@captype{figure}\caption}
\newcommand\tabcaption{\def\@captype{table}\caption}
\newcommand{\myfont}[2]{{\fontfamily{#1}\selectfont #2}}

\newenvironment{para}{
  \begin{description}[
        font = \bfseries\uline,
        labelindent = \parindent,
        itemsep = 0pt,
        parsep = 0pt,
        topsep = 0pt,
        partopsep = 0pt,
      ]
    }{
  \end{description}
}

\newenvironment{feae}{
  \begin{enumerate}[font=\bfseries, labelindent=0pt, itemsep=0pt,
      parsep=0pt, topsep=0pt, partopsep=0pt]
    }{
  \end{enumerate}
}
\newenvironment{feai}{
  \begin{itemize}[font=\bfseries, itemsep=0pt, parsep=0pt, topsep=0pt,
    partopsep=0pt]}
    {
  \end{itemize}
}
\newenvironment{inlinee}{
  \begin{enumerate*}[label=(\arabic*), font=\rmfamily,
    before=\unskip{：},itemjoin={{；}},itemjoin*={{，以及：}}]
  }{
  \end{enumerate*}。
}
\newenvironment{fead}{
  \begin{description}[font=\bfseries\uline,labelindent=\parindent,itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt]
    }{
  \end{description}
}

% 对于 tcolorbox 中 listings 库的 ''tcblatex'' style 的重现，
% 添加了新的关键词
\lstdefinestyle{latexcn}{
  language=[LaTeX]TeX,
  % More Keywords
  classoffset=0,
  texcsstyle=*\color{blue},
  moretexcs={
    chapter,
    section,
    subsection,
    setlength,
    thechapter,
    thesection,
    thesubsection,
    theequation,
    chaptermark,
    chaptername,
    appendix,
    bibname,
    refname,
    bibpreamble,
    bibfont,
    citenumfont,
    bibnumfmt,
    bibsep,
  },
  classoffset=1,
  texcsstyle=*\color{orange!75!black},
  moretexcs={
    xeCJKsetup,
    setCJKmainfont,
    newCJKfontfamily,
    CJKfontspec,
    CTEXthechapter,
    songti,
    heiti,
    fangsong,
    kaishu,
    yahei,
    lishu,
    youyuan,
    middle,
    text,
    tag,
    boldsymbol,
    mathbb,
    dddot,
    ddddot,
    iint,
    varoiint,
    dfrac,
    tfrac,
    cfrac,
    leftroot,
    uproot,
    underbracket,
    xleftarrow,
    xrightarrow,
    overset,
    underset,
    sideset,
    mathring,
    leqslant,
    geqslant,
    because,
    therefore,
    shortintertext,
    binom,
    dbinom,
    implies,
    thesubequation,
    impliedby,
    genfrac,
    theoremstyle,
    qedhere,
    wideparen,
    intertext,
    xlongequal,
    xLeftrightarrow,
    xleftrightarrow,
    xLongleftarrow,
    xLongrightarrow,
    definecolor,
    color,
    textcolor,
    colorbox,
    fcolorbox,
    hyperref,
    autoref,
    href,
    url,
    nolinkurl,
    includegraphics,
    graphicspath,
    scalebox,
    rotatebox,
    animategraphics,
    newcolumntype,
    arraybackslash,
    multirow,
    captionsetup,
    thead,
    multirowcell,
    makecell,
    Xhline,
    Xcline,
    diagbox,
    toprule,
    midrule,
    bottomrule,
    DeclareFloatingEnvironment,
    uline,
    uuline,
    dashuline,
    dotuline,
    uwave,
    sout,
    xout,
    lhead,
    chead,rhead,
    lfoot,
    cfoot,
    rfoot,
    fancyhf,
    fancyhead,
    fancyfoot,
    fancypagestyle,
    newfontfamily,
    titlelabel,
    titleformat,
    titlespacing,
    titleline,
    titlerule,
    dottecontents,
    titlecontents,
    setlist,
    lstdefinelanguage,
    lstdefinestyle,
    lstset,
    lstnewenvironment,
    tcbuselibrary,
    newtcblisting,
    newtcbox,
    DeclareTCBListing
    setcitestyle,printindex,
    hologo,
    lettrine,
    endfirsthead,
    endhead,
    endlastfoot,
    columncolor,
    rowcolors,
    modulolinenumbers,
    MakeShortVerb,
    tikz
  }
}

% cmd & envi
\newtcbox{\latexline}[1][green]{
  on line,
  before upper=\ttfamily\char`\\,
  arc = 0pt,
  outer arc = 0pt,
  colback = #1!10!white,
  colframe = #1!50!black,
  boxsep = 0pt,
  left = 1pt,
  right = 1pt,
  top = 1pt,
  bottom = 1pt,
  boxrule = 0pt,
  bottomrule = 1pt,
  toprule = 1pt,
}
\newtcbox{\envi}[1][violet!70!cyan]{on line,before upper=\ttfamily,
  arc=0pt,outer arc=0pt,colback=#1!10!white,colframe=#1!50!black,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,
  boxrule=0pt,bottomrule=1pt,toprule=1pt,
}
\newtcbox{\pkg}[1][orange!70!red]{
  on line,
  before upper = {\rule[-0.2ex]{0pt}{1ex}\ttfamily},
  arc = 0.8ex,
  colback = #1!30!white,
  colframe = #1!50!black,
  boxsep = 0pt,
  left = 1.5pt,
  right = 1.5pt,
  top = 1pt,
  bottom = 1pt,
  boxrule = 1pt,
}
\newcommand{\tikzkw}[1]{\texttt{#1}}

% Fix solution from the tcolorbox package author
\makeatletter
\tcbset{
  tikz upper/.style={before upper=\centering\tcb@shield@externalize
    \begin{tikzpicture}[{#1}],after upper=
  \end{tikzpicture}},%
  tikz lower/.style={before lower=\centering\tcb@shield@externalize
    \begin{tikzpicture}[{#1}],after lower=
  \end{tikzpicture}},%
}
\makeatother

% tcblisting definitions
\newtcblisting{latex}{
  breakable,
  skin = bicolor,
  colback = gray!30!white,
  colbacklower = white,
  colframe = cyan!75!black,
  listing only,
  left = 6mm,
  top = 2pt,
  bottom = 2pt,
  fontupper =\small,
  listing options={style=latexcn},
}

\NewTCBListing{codeshow}{ !O{listing side text} }{
  skin=bicolor,colback=gray!30!white,
  colbacklower=pink!50!yellow,colframe=cyan!75!black,
  valign lower=center,
  left=6mm,righthand width=0.4\linewidth,fontupper=\small,
  % listing style
  listing options={style=latexcn},#1,
}

% xparse library required
\NewTCBListing{tikzshow}{ O{} }{
  tikz lower={#1},
  halign lower=center,valign lower=center,
  skin=bicolor,colback=gray!30!white,
  colbacklower=white,colframe=cyan!75!black,
  left=6mm,righthand width=3.5cm,listing outside text,
  listing options={language=tikzlang}
}

\NewTCBListing{tikzshowenvi}{ O{} }{
  halign lower=center,valign lower=center,
  skin=bicolor,colback=gray!30!white,
  colbacklower=white,colframe=cyan!75!black,
  left=6mm,righthand width=3.5cm,listing outside text,
  listing options={language=tikzlang},#1
}

% 奇怪的小定义
\newcommand{\dpar}{\\ \mbox{}}  % 空两行
\newcommand{\qd}[1]{{\bfseries{#1}}}  % 强调
\newcommand{\co}[1]{{\bfseries{#1}}}  % Style of concept
\newcommand{\RED}[1]{{\color{cyan}{#1}}}
\newcommand{\cmmd}[1]{\fbox{\texttt{\char92{}#1}}}
\newcommand{\charef}[1]{第\ref{#1}章}
\newcommand{\secref}[1]{第\ \ref{#1}\ 节}
\newcommand{\pref}[1]{第\pageref{#1}页}
\newcommand{\fref}[1]{图\ref{#1}}
\newcommand{\tref}[1]{表\ref{#1}}
